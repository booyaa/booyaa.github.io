<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Adding search to your cobalt site - Part Two</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />
<meta name="author" content="Mark Sta Ana">
<meta name="description" content="Personal website of Mark Sta Ana, aged 7 3/4."/>
<meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101141559-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
<body data-route=blog>
  <nav class="menu">
  <a class="menu-item " href="/about/">booyaa</a>
  <a class="menu-item current" href="/">blog</a>
  <a class="menu-item " href="/talks">talks</a>
  <a class="menu-item" href="/search/">search</a>
  <a class="menu-item" href="/archive/">archive</a>
  <a class="menu-item icon" href="http://github.com/booyaa"><i class="fa fa-github"></i></a>
  <a class="menu-item icon" href="http://twitter.com/booyaa"><i class="fa fa-twitter"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>Adding search to your cobalt site - Part Two</h1>
       
      
      
      								
          
    	 

			<time pubdate="pubdate">Jun 20, 2017 - Reading time: 2 minutes.</time><br />
      
      <p>This will be a two part post, where I detail the steps it took to enable search on my <a href="https://github.com/cobalt-org/cobalt.rs">Cobalt</a> site.</p>
<p>As you may have gathered in <a href="/2017/adding-search-to-your-cobalt-site-part-one/">part one</a> creating manual document collections is a bit of a chore, and can be easily done using the liquid templating engine.</p>
<h2>lunr.liquid</h2>
<h3>front matter</h3>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#bf616a;">title</span><span style="background-color:#2b303b;color:#c0c5ce;">: </span><span style="background-color:#2b303b;color:#bf616a;">lunr index
path</span><span style="background-color:#2b303b;color:#c0c5ce;">: </span><span style="background-color:#2b303b;color:#a3be8c;">/js/lunr_docs.json
</span><span style="background-color:#2b303b;color:#c0c5ce;">---
</span></pre>
<p>The item of note here, is the path which Cobalt will use to create the lunr document collection.</p>
<h3>content</h3>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">{% assign idx = 0 %}
{% assign post_count = collections.posts.pages | size %}
</span><span style="background-color:#2b303b;color:#8fa1b3;">[</span><span style="background-color:#2b303b;color:#b48ead;">
{% </span><span style="background-color:#2b303b;color:#d08770;">for post </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">n collections</span><span style="background-color:#2b303b;color:#b48ead;">.</span><span style="background-color:#2b303b;color:#d08770;">posts</span><span style="background-color:#2b303b;color:#b48ead;">.</span><span style="background-color:#2b303b;color:#d08770;">pages</span><span style="background-color:#2b303b;color:#b48ead;"> %}
{% </span><span style="background-color:#2b303b;color:#d08770;">assign </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">dx </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#a3be8c;">idx </span><span style="background-color:#2b303b;color:#b48ead;">| </span><span style="background-color:#2b303b;color:#d08770;">plus</span><span style="background-color:#2b303b;color:#b48ead;">: 1 %}
    { 
        &quot;</span><span style="background-color:#2b303b;color:#d08770;">title</span><span style="background-color:#2b303b;color:#b48ead;">&quot; : &quot;{{ </span><span style="background-color:#2b303b;color:#d08770;">post</span><span style="background-color:#2b303b;color:#b48ead;">.</span><span style="background-color:#2b303b;color:#d08770;">title</span><span style="background-color:#2b303b;color:#b48ead;"> }}&quot;,

        {% </span><span style="background-color:#2b303b;color:#d08770;">assign tags_list </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#a3be8c;">post.data.tags </span><span style="background-color:#2b303b;color:#b48ead;">| </span><span style="background-color:#2b303b;color:#d08770;">replace</span><span style="background-color:#2b303b;color:#b48ead;">: &quot; &quot;, &quot;&quot; | </span><span style="background-color:#2b303b;color:#d08770;">split</span><span style="background-color:#2b303b;color:#b48ead;">: &quot;,&quot;  %}
        {% </span><span style="background-color:#2b303b;color:#d08770;">assign tags_size </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#a3be8c;">tags_list </span><span style="background-color:#2b303b;color:#b48ead;">| </span><span style="background-color:#2b303b;color:#d08770;">size </span><span style="background-color:#2b303b;color:#b48ead;">| </span><span style="background-color:#2b303b;color:#d08770;">minus</span><span style="background-color:#2b303b;color:#b48ead;">: 1 %}
        {% </span><span style="background-color:#2b303b;color:#d08770;">assign </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">dx2 </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#a3be8c;">0</span><span style="background-color:#2b303b;color:#b48ead;"> %}
        &quot;</span><span style="background-color:#2b303b;color:#d08770;">tags</span><span style="background-color:#2b303b;color:#b48ead;">&quot;: [
        {% </span><span style="background-color:#2b303b;color:#d08770;">for tag </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">n tags_list</span><span style="background-color:#2b303b;color:#b48ead;"> %}
            &quot;{{ </span><span style="background-color:#2b303b;color:#d08770;">tag</span><span style="background-color:#2b303b;color:#b48ead;"> }}&quot;{% </span><span style="background-color:#2b303b;color:#d08770;">if </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">dx2</span><span style="background-color:#2b303b;color:#b48ead;"> &lt; </span><span style="background-color:#2b303b;color:#d08770;">tags_size</span><span style="background-color:#2b303b;color:#b48ead;"> %},{% </span><span style="background-color:#2b303b;color:#d08770;">endif</span><span style="background-color:#2b303b;color:#b48ead;"> %}
            {% </span><span style="background-color:#2b303b;color:#d08770;">assign </span><span style="background-color:#2b303b;color:#b48ead;">i</span><span style="background-color:#2b303b;color:#d08770;">dx2 </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#a3be8c;">idx2 </span><span style="background-color:#2b303b;color:#b48ead;">| </span><span style="background-color:#2b303b;color:#d08770;">plus</span><span style="background-color:#2b303b;color:#b48ead;">: 1 %}
        {% </span><span style="background-color:#2b303b;color:#d08770;">endfor</span><span style="background-color:#2b303b;color:#b48ead;"> %}
        </span><span style="background-color:#2b303b;color:#8fa1b3;">]</span><span style="background-color:#2b303b;color:#b48ead;">,
        &quot;href&quot; : &quot;</span><span style="background-color:#2b303b;color:#c0c5ce;">{{ post.permalink }}&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#bf616a;">content</span><span style="background-color:#2b303b;color:#b48ead;">&quot; : &quot;</span><span style="background-color:#2b303b;color:#c0c5ce;">{{ post.content | strip_html | strip_newlines | replace: &quot;</span><span style="background-color:#2b303b;color:#96b5b4;">\&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">, </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;\\&quot;</span><span style="background-color:#2b303b;color:#a3be8c;"> }}</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
    }{% if idx &lt; post_count %},{% endif %}
{% endfor %}
]
</span></pre>
<p>The only real difference here between a blog index is that I'm tracking the last post using an index so I can omit a trailing comma.</p>
<p>Don't forget to remove the manually generated document collection (<code>lunr_docs.json</code>) from the assets directory for javascript files (<code>js/</code>) , as this caught me out and made me wonder why the index wasn't being updated.</p>
<h2>Updates</h2>
<p>2017-06-21 - Change references to the lunr index to the lunr document collection.</p>

    </article>
    <br /><br />
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
