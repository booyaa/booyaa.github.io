<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Gatsby and WordPress: Setup</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />
<meta name="author" content="Mark Sta Ana">
<meta name="description" content="Personal website of Mark Sta Ana, aged 7 3/4."/>
<meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101141559-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
<body data-route=blog>
  <nav class="menu">
  <a class="menu-item " href="/about/">booyaa</a>
  <a class="menu-item current" href="/">blog</a>
  <a class="menu-item " href="/talks">talks</a>
  <a class="menu-item" href="/search/">search</a>
  <a class="menu-item" href="/archive/">archive</a>
  <a class="menu-item icon" href="http://github.com/booyaa"><i class="fa fa-github"></i></a>
  <a class="menu-item icon" href="http://twitter.com/booyaa"><i class="fa fa-twitter"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>Gatsby and WordPress: Setup</h1>
       
      
      
      								
          
    	 

			<time pubdate="pubdate">Jan 01, 2019 - Reading time: 4 minutes.</time><br />
      
      <p><em>This is the start of a blog post series about creating Gatsby site with content pulled in from a WordPress site.</em></p>
<h2>Setup</h2>
<ul>
<li>Create a new Gatsby site called “wordsby” <code>gatsby new wordsby</code>, this will create a new site using the starter site.</li>
<li>Enter your new site: <code>cd wordsby</code></li>
<li>Setup a new GitHub repo and push your changes up to your repo</li>
</ul>
<h2>Checkpoint: start up our site locally</h2>
<ul>
<li>Let’s start our new site up <code>gatsby develop</code></li>
<li>Open up your new site on http://localhost:8000</li>
<li>Open <code>gatsby-config.js</code> in your editor and change <code>siteMetadata.title</code> to something different, notice the site changed after you saved the changes?</li>
</ul>
<p>If you got stuck, you can check out the following Git hash: <code>168483273e38b94dd35dd5063a44c4696c69ea11</code></p>
<p>Setup WordPress and the Gatsby plugin</p>
<ul>
<li>Lets setup WordPress, go ahead and sign up for a free WordPress site. It’s fine to uses one of the free non-WordPress.com sites.</li>
<li>Setup a new developer app that will allow us to connect to the blog: <a href="https://developer.wordpress.com/apps/">Developer.WordPress.com</a>
<ul>
<li>Make a note of your
<ul>
<li>WordPress URL</li>
<li>Credentials (your email address and password that you used to create your blog)</li>
<li>Client Id</li>
<li>Client Secret</li>
</ul>
</li>
</ul>
</li>
<li>Install the WordPress plugin <code>npm install --save gatsby-source-wordpress</code></li>
<li>Let’s edit our <code>gatsby-config.js</code></li>
</ul>
<p>Add the following entry to your <code>plugins</code> section</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">    {
      resolve: `</span><span style="background-color:#2b303b;color:#a3be8c;">gatsby-source-wordpress</span><span style="background-color:#2b303b;color:#c0c5ce;">`,
      </span><span style="background-color:#2b303b;color:#bf616a;">options</span><span style="background-color:#2b303b;color:#c0c5ce;">: {
        baseUrl: process.env.WORDPRESS_BASE_URL,
        </span><span style="background-color:#2b303b;color:#bf616a;">protocol</span><span style="background-color:#2b303b;color:#c0c5ce;">: process.env.WORDPRESS_PROTOCOL,
        </span><span style="background-color:#2b303b;color:#bf616a;">hostingWPCOM</span><span style="background-color:#2b303b;color:#c0c5ce;">: (process.env.WORDPRESS_HOSTING_WPCOM === &#39;</span><span style="background-color:#2b303b;color:#a3be8c;">true</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;),
        </span><span style="background-color:#2b303b;color:#bf616a;">useACF</span><span style="background-color:#2b303b;color:#c0c5ce;">: (process.env.WORDPRESS_USE_ACF === &#39;</span><span style="background-color:#2b303b;color:#a3be8c;">true</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;),
        </span><span style="background-color:#2b303b;color:#bf616a;">verboseOutput</span><span style="background-color:#2b303b;color:#c0c5ce;">: (process.env.WORDPRESS_VERBOSE_OUTPUT === &#39;</span><span style="background-color:#2b303b;color:#a3be8c;">true</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;),
        </span><span style="background-color:#2b303b;color:#bf616a;">auth</span><span style="background-color:#2b303b;color:#c0c5ce;">: {
          wpcom_app_clientSecret: process.env.WORDPRESS_CLIENT_SECRET,
          </span><span style="background-color:#2b303b;color:#bf616a;">wpcom_app_clientId</span><span style="background-color:#2b303b;color:#c0c5ce;">: process.env.WORDPRESS_CLIENT_ID,
          </span><span style="background-color:#2b303b;color:#bf616a;">wpcom_user</span><span style="background-color:#2b303b;color:#c0c5ce;">: process.env.WORDPRESS_USER,
          </span><span style="background-color:#2b303b;color:#bf616a;">wpcom_pass</span><span style="background-color:#2b303b;color:#c0c5ce;">: process.env.WORDPRESS_PASSWORD,
        },
        </span><span style="background-color:#2b303b;color:#bf616a;">includedRoutes</span><span style="background-color:#2b303b;color:#c0c5ce;">: [
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">**/posts</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">**/pages</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">**/tags</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        ],
      },
    },
</span></pre>
<p>You’ve probably noticed we’ve made use of environmental variables to store WordPress info. This is good practice and prevents accidental leakage of secrets  (storing them in a config file and committing to source control).</p>
<p>Let’s test our credentials by adding them to a <code>.env</code> file</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">WORDPRESS_BASE_URL=xxx.wordpress.com
WORDPRESS_PROTOCOL=https
WORDPRESS_HOSTING_WPCOM=true
WORDPRESS_USE_ACF=false
WORDPRESS_VERBOSE_OUTPUT=true
WORDPRESS_CLIENT_SECRET=xxx
WORDPRESS_CLIENT_ID=xxx
WORDPRESS_USER=xxx@example.com
WORDPRESS_PASSWORD=xxx
</span></pre>
<p>Don’t forget to include  <code>.env</code> in your <code>.gitignore</code> (the starter Gatsby site adds it by default, but it’s good practice to check it’s not being tracked by Git).</p>
<p>Whilst the <code>dotenv</code> module is installed as part of Gatsby it’s not enabled by default, so  find your  <code>module.exports</code> line add this  code above  it:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#8fa1b3;">require</span><span style="background-color:#2b303b;color:#c0c5ce;">(&#39;</span><span style="background-color:#2b303b;color:#a3be8c;">dotenv</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;).</span><span style="background-color:#2b303b;color:#8fa1b3;">config</span><span style="background-color:#2b303b;color:#c0c5ce;">();
</span></pre>
<h2>Checkpoint: verify WordPress credentials</h2>
<p>Let’s restart the Dev environment using <code>gatsby develop</code></p>
<p>Let’s go to the graphic explorer <code>http://localhost:8000/___graphql</code> this time. Paste the following <code>graphql</code> query into the left panel and hit the play button:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">{
  allWordpressPost {
    edges {
      node {
        title
        excerpt
        tags {
          name
        }
      }
    }
  }
}
</span></pre>
<p>If the plugin has successfully loaded and was able to connect to your WordPress blog you should be able to see data on the right panel.</p>
<h3>Troubleshooting</h3>
<p>If you’ve copied the default WordPress for verbose output then, there the plugin should be in debug mode.  Look for the following warning:</p>
<p><code>warning The gatsby-source-wordpress plugin has generated no Gatsby nodes. Do you need it?</code></p>
<p>This indicates there was an error parsing one of the values you gave in <code>.env</code>.</p>
<p>If you see the following:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">Path: /oauth2/token
The server response was &quot;400 Bad Request&quot;
</span></pre>
<p>Then the username or password may be wrong. Test them by logging into WordPress.com.</p>
<p>If you see the following:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">=== [ Fetching wordpress__ ] ===
=== [ Fetching wordpress__ ] ===
=== [ Fetching wordpress__ ] ===
</span></pre>
<p>I’m currently investigating this, and I believe this could be to do with your email address containing <code>+</code> e.g. <code>joe+wordpress@example.com</code></p>
<p>If you got stuck, you can check out the following Git hash: <a href="https://github.com/booyaa/wordsby/commit/3ee8aae5e0c8d6f45127963f776fd1c9358dd647"><code>3ee8aae5e0c8d6f45127963f776fd1c9358dd647</code></a></p>
<p><strong>The Gatsby x WordPress Blog Post series</strong></p>
<ul>
<li><a href="/2019/gatsby-wordpress-keeping-it-cheap-and-staying-in-touch">Keeping it cheap and staying in touch</a></li>
<li><em>Setup</em></li>
<li><a href="/2019/gatsby-wordpress-creating-content">Creating Content</a></li>
<li><a href="/2019/gatsby-wordpress-index-page">Creating an index page</a></li>
<li><a href="/2019/gatsby-wordpress-pages">Creating WordPress Page Types</a></li>
<li><a href="/2019/gatsby-wordpress-netlify">Netlify or Die!</a></li>
<li><a href="/2019/gatsby-wordpress-cutlasses-and-webhooks">Yarr! Cutlasses and Webhooks!</a></li>
<li><a href="/2019/gatsby-wordpress-summary">Summary</a></li>
</ul>

    </article>
    <br /><br />
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
