<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>AWS DevOps Pro Certification Blog Post Series: Code Commit</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />
<meta name="author" content="Mark Sta Ana">
<meta name="description" content="Personal website of Mark Sta Ana, aged 7 3/4."/>
<meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101141559-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
<body data-route=blog>
  <nav class="menu">
  <a class="menu-item " href="/about/">booyaa</a>
  <a class="menu-item current" href="/">blog</a>
  <a class="menu-item " href="/talks">talks</a>
  <a class="menu-item" href="/search/">search</a>
  <a class="menu-item" href="/archive/">archive</a>
  <a class="menu-item icon" href="http://github.com/booyaa"><i class="fa fa-github"></i></a>
  <a class="menu-item icon" href="http://twitter.com/booyaa"><i class="fa fa-twitter"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>AWS DevOps Pro Certification Blog Post Series: Code Commit</h1>
       
      
      
      								
          
    	 

			<time pubdate="pubdate">Mar 26, 2019 - Reading time: 5 minutes.</time><br />
      
      <p><em>This is part of the blog post series: <a href="/2019/aws-devops-pro-certification-intro/">AWS DevOps Pro Certification</a></em></p>
<h2>Caveat emptor</h2>
<p>Using AWS costs money, some of these services may not be part of the AWS <a href="https://aws.amazon.com/free/">Free Tier</a>. You can keep costs down by tearing down anything you've created whilst learning, but it's still possible to run up a hefty bill so pay attention to the instances you setup!</p>
<p>I'm very lucky to be able to use my employer's AWS account. You should ask your place of work if a similar arrangement can be made as part of your study.</p>
<h2>Velocius quam asparagi conquantur</h2>
<p>The format of the blog posts is liable to change as I try refine my mental model of each domain, so be sure to revisit the blog posts on a regular basis.</p>
<h2>What?</h2>
<p>Code Commit is:</p>
<ul>
<li>a managed Version Control service</li>
<li>Git based (using HTTPS or SSH for connections)</li>
<li>Files are encrypted at rest, keys can be found in can be found in IAM &gt; Encryption Keys.
<ul>
<li>AWS CLI:  <code>aws kms list-aliases | jq '.Aliases[] | select(.AliasArn | contains(&quot;codecommit&quot;))'</code></li>
</ul>
</li>
<li>Security credentials for HTTPS and SSH connections are defined in IAM per user. Pro-tip: if you need to brush up on IAM, see Helen Anderson's excellent guide: <a href="https://dev.to/helenanders26/aws-series-dont-you-know-who-iam-26b0">Don't you know who IAM?</a></li>
</ul>
<h2>Why?</h2>
<p>Spotted a little gem in the <a href="https://aws.amazon.com/codecommit/faqs/">FAQ</a> that asks how Code Commit compares against a versioned S3 bucket. Enabling versioning on an S3 bucket means that when you upload a file that already exists, the older version is replaced, but you can still view and download it through the version history (see screenshot).</p>
<p><img src="/img/devops-s3-versioning.png" alt="" /></p>
<p>Whilst this might be okay for reverting back to the previous version of the code, it's handled on a per-file basis. Now imagine trying to track all the files that make up a version of your code?</p>
<p>This is really an argument against version control systems (VCS) and file versioning. VCS was created to simplify change tracking in the source code.</p>
<p>Pro-tip: bit rusty on S3? Yup Helen's got you covered again with <a href="https://dev.to/helenanders26/aws-series-whats-in-the-bucket-1k3">What's in the bucket?</a></p>
<h2>When?</h2>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">SDLC automation
~~~~~~~~~~~~~~~~

CodeCommit -&gt; ???
</span></pre>
<p>This is the start of SDLC automation. Everything else hinges on a source code repository. CI can't build and test code until it can pull the code from somewhere.</p>
<h2>How?</h2>
<p>This is loosely based around the <a href="https://docs.aws.amazon.com/codecommit/latest/userguide/getting-started.html">Getting Started</a> section of the User Guide.</p>
<p>The main difference is that I'm going to use the CLI instead of the Web UI to aid in learning these commands too.</p>
<p>Create a repo <code>aws codecommit create-repository --repository-name hello-codecommit</code></p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">{
    &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">repositoryMetadata</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: {
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">accountId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">123456</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">repositoryId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">dc2c437d-e850-4a8b-82e7-7ad85fee99d1</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">repositoryName</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">hello-codecommit</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">lastModifiedDate</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: </span><span style="background-color:#2b303b;color:#d08770;">1553613552.003</span><span style="background-color:#2b303b;color:#c0c5ce;">,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">creationDate</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: </span><span style="background-color:#2b303b;color:#d08770;">1553613552.003</span><span style="background-color:#2b303b;color:#c0c5ce;">,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">cloneUrlHttp</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">https://git-codecommit.xxx.amazonaws.com/v1/repos/hello-codecommit</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">cloneUrlSsh</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">ssh://git-codecommit.xxx.amazonaws.com/v1/repos/hello-codecommit</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Arn</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">arn:aws:codecommit:xxx:1234567890:hello-codecommit</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
    }
}
</span></pre>
<p>We're going to use SSH to communicate with our new repo, so let's set up a dedicated key (hello-codecommit) and upload the public key to our IAM account.</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#8fa1b3;">ssh-keygen</span><span style="background-color:#2b303b;color:#bf616a;"> -b</span><span style="background-color:#2b303b;color:#c0c5ce;"> 4096</span><span style="background-color:#2b303b;color:#bf616a;"> -f</span><span style="background-color:#2b303b;color:#c0c5ce;"> hello-codecommit-ssh
</span><span style="background-color:#2b303b;color:#65737e;"># output has been omitted
</span><span style="background-color:#2b303b;color:#c0c5ce;">aws iam upload-ssh-public-key</span><span style="background-color:#2b303b;color:#bf616a;"> --user</span><span style="background-color:#2b303b;color:#c0c5ce;"> booyaa \
</span><span style="background-color:#2b303b;color:#bf616a;">  --ssh-public-key-body </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;$</span><span style="background-color:#2b303b;color:#a3be8c;">(</span><span style="background-color:#2b303b;color:#8fa1b3;">cat</span><span style="background-color:#2b303b;color:#a3be8c;"> hello-codecommit-ssh.pub)</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
</span></pre><pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">{
    &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">SSHPublicKey</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: {
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">UserName</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">booyaa</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">SSHPublicKeyId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">VALUE_OF_SSHPUBLICKEYID</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Fingerprint</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">FINGERPRINT</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">SSHPublicKeyBody</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">REDACTED</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Status</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Active</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">UploadDate</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;: &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">2019-03-26T15:46:14Z</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
    }
}
</span></pre>
<p>Make a note of your <code>SSHPublicKeyId</code>, we'll need to add new entry to your ssh config (<code>~/.ssh/config</code>):</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">Host git-codecommit.*.amazonaws.com
User VALUE_OF_SSHPUBLICKEYID
IdentityFile /path/to/hello-codecommit-ssh
</span></pre>
<p>Let's clone our empty repo, you can find the Git URL by looking at the output from running <code>aws codecommit create-repository</code>. The key name is <code>cloneUrlSsh</code>.</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> clone ssh://git-codecommit.xxx.amazonaws.com/v1/repos/hello-codecommit
</span><span style="background-color:#2b303b;color:#8fa1b3;">Cloning</span><span style="background-color:#2b303b;color:#c0c5ce;"> into &#39;</span><span style="background-color:#2b303b;color:#a3be8c;">hello-codecommit</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;...
</span><span style="background-color:#2b303b;color:#65737e;"># omitting boring git stuff
</span><span style="background-color:#2b303b;color:#c0c5ce;">warning: You appear to have cloned an empty repository.
</span></pre>
<p>Let's go into our new repo, add a file, commit and push it back up.</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#96b5b4;">cd</span><span style="background-color:#2b303b;color:#c0c5ce;"> hello-codecommit
</span><span style="background-color:#2b303b;color:#96b5b4;">echo </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Hello world</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot; &gt; index.html
</span><span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> add index.html
</span><span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> commit</span><span style="background-color:#2b303b;color:#bf616a;"> -m </span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;</span><span style="background-color:#2b303b;color:#a3be8c;">initial commit</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;
</span><span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> push
</span></pre>
<p>Next, let's create a feature branch so we can use the pull request feature.</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> checkout</span><span style="background-color:#2b303b;color:#bf616a;"> -b</span><span style="background-color:#2b303b;color:#c0c5ce;"> feature/index-markup
</span></pre>
<p>replace the contents <code>index.html</code> with the following:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">&lt;!</span><span style="background-color:#2b303b;color:#bf616a;">doctype</span><span style="background-color:#2b303b;color:#c0c5ce;"> html&gt;
&lt;</span><span style="background-color:#2b303b;color:#bf616a;">html </span><span style="background-color:#2b303b;color:#d08770;">lang</span><span style="background-color:#2b303b;color:#c0c5ce;">=&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">en</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;&gt;
&lt;</span><span style="background-color:#2b303b;color:#bf616a;">head</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
  &lt;</span><span style="background-color:#2b303b;color:#bf616a;">meta </span><span style="background-color:#2b303b;color:#d08770;">charset</span><span style="background-color:#2b303b;color:#c0c5ce;">=&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">utf-8</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;&gt;
  &lt;</span><span style="background-color:#2b303b;color:#bf616a;">title</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;Hello world&lt;/</span><span style="background-color:#2b303b;color:#bf616a;">title</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
&lt;/</span><span style="background-color:#2b303b;color:#bf616a;">head</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
&lt;</span><span style="background-color:#2b303b;color:#bf616a;">body</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
  Hello world
&lt;/</span><span style="background-color:#2b303b;color:#bf616a;">body</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
&lt;/</span><span style="background-color:#2b303b;color:#bf616a;">html</span><span style="background-color:#2b303b;color:#c0c5ce;">&gt;
</span></pre><pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> commit</span><span style="background-color:#2b303b;color:#bf616a;"> -am </span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;</span><span style="background-color:#2b303b;color:#a3be8c;">(feat) use markup</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;
</span><span style="background-color:#2b303b;color:#8fa1b3;">git</span><span style="background-color:#2b303b;color:#c0c5ce;"> push</span><span style="background-color:#2b303b;color:#bf616a;"> -u</span><span style="background-color:#2b303b;color:#c0c5ce;"> origin feature/index-markup
</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#c0c5ce;"> codecommit create-pull-request \
</span><span style="background-color:#2b303b;color:#bf616a;">  --title </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Feature: use markup for the index page</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot; \
</span><span style="background-color:#2b303b;color:#bf616a;">  --description </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">What: switch from plain text to markup. Why: markup allows for a richer web experience</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot; \
</span><span style="background-color:#2b303b;color:#bf616a;">  --client-request-token</span><span style="background-color:#2b303b;color:#c0c5ce;"> booyaa-markup-1234 \
</span><span style="background-color:#2b303b;color:#bf616a;">  --targets</span><span style="background-color:#2b303b;color:#c0c5ce;"> repositoryName=hello-codecommit,sourceReference=feature/index-markup
</span></pre>
<p>The <code>client-request-token</code> switch is a token we randomly generated, it's used by the API to ensure request cannot be repeated with a changed parameter. If you run that command again, you get the output from the previous transaction instead of a new pull request.</p>
<p>The <code>targets</code> switch requires the repository name (hello-codecommit) and the branch you're raising a pull request for (feature/index-markup).</p>
<p>Finally let's teardown <code>aws codecommit delete-repository --repository-name hello-codecommit-ui</code>, you'll get back the <code>repositoryId</code> if you were successful.</p>
<h2>API and CLI features and verbs</h2>
<h3>Features</h3>
<ul>
<li>Repository</li>
<li>Branch</li>
<li>File/Folder</li>
<li>Commit/Differences/Blob</li>
<li>PullRequest</li>
<li>Comments</li>
<li>Trigger</li>
</ul>
<h3>Verbs (CRUD)</h3>
<ul>
<li>create</li>
<li>batch-get/get/list/describe</li>
<li>update/put</li>
<li>delete</li>
</ul>
<h3>Outliers</h3>
<ul>
<li>test-repository-triggers</li>
<li>merge-pull-request-by-fast-forward</li>
</ul>
<h2>AWS DevOps Pro Certification Blog Post Series</h2>
<ul>
<li><a href="/2019/aws-devops-pro-certification-intro/">Intro</a></li>
<li><a href="/2019/aws-devops-pro-certification-sdlc-intro/">SDLC automation</a>
<ul>
<li>Code Commit</li>
<li><a href="/2019/blog/aws-devops-pro-certification-code-build/">Code Build</a></li>
<li><a href="/2019/aws-devops-pro-certification-code-deploy/">Code Deploy</a></li>
<li><a href="/2019/aws-devops-pro-certification-code-pipeline">Code Pipeline</a></li>
</ul>
</li>
<li>Domain 2: <a href="/2019/aws-devops-pro-certification-configuration-management-and-infrastructure-as-code-intro">Configuration Management and Infrastructure as Code</a></li>
<li>Domain 3: <a href="/2019/aws-devops-pro-certification-monitoring-and-logging">Monitoring and Logging</a></li>
<li>Domain 4: <a href="/2019/aws-devops-pro-certification-policy-standards-automation/">Policies and Standards Automation</a></li>
<li>Domain 5: <a href="/2019/aws-devops-pro-certification-incident-and-event-response/">Incident and Event Response</a></li>
<li>Domain 6: <a href="/2019/aws-devops-pro-certification-high-availability-fault-tolerance-disaster-recover/">High Availability, Fault Tolerance, and Disaster Recovery</a></li>
</ul>

    </article>
    <br /><br />
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
