<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>AWS DevOps Pro Certification Blog Post Series: AWS Lambda</title>
<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />
<meta name="author" content="Mark Sta Ana">
<meta name="description" content="Personal website of Mark Sta Ana, aged 7 3/4."/>
<meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" /> 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101141559-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>
<body data-route=blog>
  <nav class="menu">
  <a class="menu-item " href="/about/">booyaa</a>
  <a class="menu-item current" href="/">blog</a>
  <a class="menu-item " href="/talks">talks</a>
  <a class="menu-item" href="/search/">search</a>
  <a class="menu-item" href="/archive/">archive</a>
  <a class="menu-item icon" href="http://github.com/booyaa"><i class="fa fa-github"></i></a>
  <a class="menu-item icon" href="http://twitter.com/booyaa"><i class="fa fa-twitter"></i></a>
  <a class="menu-item icon" href="/rss.xml"><i class="fa fa-rss"></i></a>
  <hr>
</nav>

  <main>
    <article>
      <h1>AWS DevOps Pro Certification Blog Post Series: AWS Lambda</h1>
       
      
      
      								
          
    	 

			<time pubdate="pubdate">Jun 01, 2019 - Reading time: 7 minutes.</time><br />
      
      <p><em>This is part of the blog post series: <a href="/2019/aws-devops-pro-certification-intro/">AWS DevOps Pro Certification</a></em></p>
<h2>Caveat emptor</h2>
<p>Using AWS costs money, some of these services may not be part of the AWS <a href="https://aws.amazon.com/free/">Free Tier</a>. You can keep costs down by tearing down anything you've created whilst learning, but it's still possible to run up a hefty bill so pay attention to the instances you setup!</p>
<p>I'm very lucky to be able to use my employer's AWS account. You should ask your place of work if a similar arrangement can be made as part of your study.</p>
<h2>Velocius quam asparagi conquantur</h2>
<p>The format of the blog posts is liable to change as I try to refine my mental model of each domain, so be sure to revisit the blog posts on a regular basis.</p>
<h2>What?</h2>
<p>AWS Lambda is ...</p>
<ul>
<li>a Serverless function framework</li>
<li>highly integrated with AWS services</li>
<li>a good fit for DevOps tasks</li>
</ul>
<p>Additional resources:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html?sc_ichannel=ha&amp;sc_icampaign=pa_lamdbaresourcestop&amp;sc_icontent=devguide&amp;sc_detail=1">AWS Lambda User Guide</a></li>
<li><a href="https://aws.amazon.com/lambda/faqs/">AWS Lambda FAQ</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/API_Reference.html">AWS Lambda API</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/reference/lambda/index.html">AWS Lambda CLI</a></li>
</ul>
<h2>Why?</h2>
<p>Here are some ideas that a DevOps / Infra team might use cases for AWS Lambda. None of this is new or groundbreaking innovations. The only difference is that when trying to implement these in AWS Lambda we no longer need to factor new servers, billing is per second and Lambda was built to talk with other AWS services in mind.</p>
<ul>
<li>Automate backups/cycle through EBS snapshots</li>
<li>Generating reports - use it to audit resources on AWS (if you don't want to shell out on AWS Config)</li>
<li>Perform S3 ops i.e. moving code build artefacts to a location on a given S3 bucket</li>
<li>Batch log processing - extract, transform and load (ETL) from various resources and consolidate into a central data warehouse</li>
<li>Scheduled Tasks - perform any of the above use cases at a given schedule, just like cron jobs</li>
<li>ChatOps - running Slack chatbots to manage and report against your infrastructure</li>
</ul>
<p>Use cases inspired by the epagon blog post: <a href="https://epsagon.com/blog/why-devops-engineers-love-aws-lambda/">Why DevOps Engineers Love AWS</a></p>
<h2>When?</h2>
<ul>
<li>You need to perform a DevOps task, but don't want to go through the trouble of provisioning an application server to host it.</li>
<li>You're trying to break up a monolithic management server that's responsible for scheduling and running DevOps tasks.</li>
</ul>
<h2>How?</h2>
<p>We're going to use a simple example where the DevOps engineer wants to log all files being uploaded for a given S3 bucket. A lot of the hard work around this tutorial was done via Sunil Dalal's blog post,  &quot;<a href="https://www.polyglotdeveloper.com/lambda/2017-07-05-Using-Lambda-as-S3-events-processor/">Using Lambda as S3 events processor</a>&quot;. Thanks, Sunil for sharing!</p>
<h3>Pre-requisites</h3>
<ul>
<li>Create a Lambda execution role to grant lambda access to services and resources. This can be done through the console using this <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html">guide</a>. Copy the ARN you'll need it when we upload the function. The role should have the following permissions applied:
<ul>
<li>allow the role to create CloudWatch log entries.</li>
<li>allow the role S3 read-only access</li>
</ul>
</li>
<li>You've got an S3 bucket (might be a good idea to create one just for this walkthrough)</li>
<li>Have the following tools installed:
<ul>
<li><a href="https://stedolan.github.io/jq/">jq</a> for wrangling JSON data out of AWS CLI</li>
<li><a href="https://github.com/jorgebastida/awslogs">awslogs</a> if you want to view CloudWatch log entries in the terminal)</li>
</ul>
</li>
<li>The AWS CLI default profile has been configured
<ul>
<li>to output JSON</li>
<li>has a fixed region</li>
</ul>
</li>
</ul>
<h3>Create files</h3>
<p>Copy the following snippet and call it <code>index.js</code></p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#ebcb8b;">exports</span><span style="background-color:#2b303b;color:#c0c5ce;">.</span><span style="background-color:#2b303b;color:#8fa1b3;">handler </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#b48ead;">async </span><span style="background-color:#2b303b;color:#c0c5ce;">(event) </span><span style="background-color:#2b303b;color:#b48ead;">=&gt; </span><span style="background-color:#2b303b;color:#c0c5ce;">{
    </span><span style="background-color:#2b303b;color:#b48ead;">var </span><span style="background-color:#2b303b;color:#bf616a;">srcBucket </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#bf616a;">event</span><span style="background-color:#2b303b;color:#c0c5ce;">.Records[</span><span style="background-color:#2b303b;color:#d08770;">0</span><span style="background-color:#2b303b;color:#c0c5ce;">].s3.bucket.name;
    </span><span style="background-color:#2b303b;color:#b48ead;">var </span><span style="background-color:#2b303b;color:#bf616a;">srcKey </span><span style="background-color:#2b303b;color:#c0c5ce;">= </span><span style="background-color:#2b303b;color:#96b5b4;">decodeURIComponent</span><span style="background-color:#2b303b;color:#c0c5ce;">(</span><span style="background-color:#2b303b;color:#bf616a;">event</span><span style="background-color:#2b303b;color:#c0c5ce;">.Records[</span><span style="background-color:#2b303b;color:#d08770;">0</span><span style="background-color:#2b303b;color:#c0c5ce;">].s3.object.key);

    console.</span><span style="background-color:#2b303b;color:#96b5b4;">log</span><span style="background-color:#2b303b;color:#c0c5ce;">(&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">bucket:</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;, </span><span style="background-color:#2b303b;color:#bf616a;">srcBucket</span><span style="background-color:#2b303b;color:#c0c5ce;">, &quot;</span><span style="background-color:#2b303b;color:#a3be8c;"> file: </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;, </span><span style="background-color:#2b303b;color:#bf616a;">srcKey</span><span style="background-color:#2b303b;color:#c0c5ce;">);
};

</span></pre>
<p>Copy the following snippet and call it <code>payload-test.json</code></p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#c0c5ce;">{
  &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">Records</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:[  
    {  
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">eventVersion</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">2.0</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">eventSource</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">aws:s3</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">awsRegion</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">us-west-2</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">eventTime</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">1970-01-01T00:00:00.000Z</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">eventName</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">ObjectCreated:Put</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">userIdentity</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">principalId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">AIDAJDPLRKLG7UEXAMPLE</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
      },
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">requestParameters</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">sourceIPAddress</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">127.0.0.1</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
      },
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">responseElements</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">x-amz-request-id</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">C3D13FE58DE4C810</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">x-amz-id-2</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">FMyUVURIY8/IgAtTv8xRjskZQpcIZ9KG4V5Wp6S7S/JRWeUWerMUE5JgHvANOjpD</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
      },
      &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">s3</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">s3SchemaVersion</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">1.0</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">configurationId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">testConfigRule</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">bucket</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">name</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">sourcebucket</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">ownerIdentity</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
            &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">principalId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">A3NL1KOZZKExample</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
          },
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">arn</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">arn:aws:s3:::sourcebucket</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
        },
        &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">object</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:{  
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">key</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">HappyFace.jpg</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">size</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:</span><span style="background-color:#2b303b;color:#d08770;">1024</span><span style="background-color:#2b303b;color:#c0c5ce;">,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">eTag</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">d41d8cd98f00b204e9800998ecf8427e</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;,
          &quot;</span><span style="background-color:#2b303b;color:#a3be8c;">versionId</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;:&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">096fKKXTRTtl3on89fVO.nfljtsv6qko</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;
        }
      }
    }
  ]
}
</span></pre>
<p>The remainder of the session can be done via the command line:</p>
<pre style="background-color:#2b303b;">
<span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME</span><span style="background-color:#2b303b;color:#c0c5ce;">=</span><span style="background-color:#2b303b;color:#a3be8c;">your-lambda-function-name
</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ROLE</span><span style="background-color:#2b303b;color:#c0c5ce;">=</span><span style="background-color:#2b303b;color:#a3be8c;">your-lambda-execution-role
</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">AWS_ACCOUNT_ID</span><span style="background-color:#2b303b;color:#c0c5ce;">=$</span><span style="background-color:#2b303b;color:#a3be8c;">(</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#a3be8c;"> sts get-caller-identity </span><span style="background-color:#2b303b;color:#c0c5ce;">| </span><span style="background-color:#2b303b;color:#8fa1b3;">jq</span><span style="background-color:#2b303b;color:#bf616a;"> -r </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">.Account</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">)
</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ROLE_ARN</span><span style="background-color:#2b303b;color:#c0c5ce;">=</span><span style="background-color:#2b303b;color:#a3be8c;">arn:aws:iam::</span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">AWS_ACCOUNT_ID</span><span style="background-color:#2b303b;color:#a3be8c;">:role/</span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ROLE
</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_BUCKET</span><span style="background-color:#2b303b;color:#c0c5ce;">=</span><span style="background-color:#2b303b;color:#a3be8c;">your-s3-bucket
</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_ARN</span><span style="background-color:#2b303b;color:#c0c5ce;">=</span><span style="background-color:#2b303b;color:#a3be8c;">arn:aws:s3:::</span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_BUCKET

</span><span style="background-color:#2b303b;color:#65737e;"># package the lambda function
</span><span style="background-color:#2b303b;color:#8fa1b3;">zip</span><span style="background-color:#2b303b;color:#c0c5ce;"> function.zip index.js

</span><span style="background-color:#2b303b;color:#65737e;"># create function
</span><span style="background-color:#2b303b;color:#c0c5ce;">aws lambda create-function</span><span style="background-color:#2b303b;color:#bf616a;"> --function-name </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --zip-file</span><span style="background-color:#2b303b;color:#c0c5ce;"> fileb://function.zip \
</span><span style="background-color:#2b303b;color:#bf616a;">  --handler</span><span style="background-color:#2b303b;color:#c0c5ce;"> index.handler \
</span><span style="background-color:#2b303b;color:#bf616a;">  --runtime</span><span style="background-color:#2b303b;color:#c0c5ce;"> nodejs10.x \
</span><span style="background-color:#2b303b;color:#bf616a;">  --role </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ROLE_ARN


</span><span style="background-color:#2b303b;color:#65737e;"># setup S3 notifications, first we&#39;ll allow the s3 bucket to invoke the lambda
</span><span style="background-color:#2b303b;color:#c0c5ce;">aws lambda add-permission \
</span><span style="background-color:#2b303b;color:#bf616a;">  --function-name </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --principal</span><span style="background-color:#2b303b;color:#c0c5ce;"> s3.amazonaws.com \
</span><span style="background-color:#2b303b;color:#bf616a;">  --statement-id </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME</span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">RANDOM </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --action </span><span style="background-color:#2b303b;color:#c0c5ce;">&quot;</span><span style="background-color:#2b303b;color:#a3be8c;">lambda:InvokeFunction</span><span style="background-color:#2b303b;color:#c0c5ce;">&quot; \
</span><span style="background-color:#2b303b;color:#bf616a;">  --source-arn </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_ARN </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --source-account </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">AWS_ACCOUNT_ID

</span><span style="background-color:#2b303b;color:#b48ead;">export </span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ARN</span><span style="background-color:#2b303b;color:#c0c5ce;">=$</span><span style="background-color:#2b303b;color:#a3be8c;">(</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#a3be8c;"> lambda get-function</span><span style="background-color:#2b303b;color:#bf616a;"> --function-name </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME  </span><span style="background-color:#2b303b;color:#c0c5ce;">| </span><span style="background-color:#2b303b;color:#8fa1b3;">jq</span><span style="background-color:#2b303b;color:#bf616a;"> -r</span><span style="background-color:#2b303b;color:#a3be8c;"> .Configuration.FunctionArn)

</span><span style="background-color:#2b303b;color:#8fa1b3;">cat </span><span style="background-color:#2b303b;color:#c0c5ce;">&lt;&lt; </span><span style="background-color:#2b303b;color:#b48ead;">EOF </span><span style="background-color:#2b303b;color:#c0c5ce;">&gt; notification.json</span><span style="background-color:#2b303b;color:#a3be8c;">
{
    &quot;LambdaFunctionConfigurations&quot;: [
      {
        &quot;Id&quot;: &quot;1234567890&quot;,
        &quot;LambdaFunctionArn&quot;: &quot;</span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_ARN</span><span style="background-color:#2b303b;color:#a3be8c;">&quot;,
        &quot;Events&quot;: [ &quot;s3:ObjectCreated:*&quot; ]
      }
    ]
}
EOF</span><span style="background-color:#bf616a;color:#2b303b;">
</span><span style="background-color:#2b303b;color:#a3be8c;">
</span><span style="background-color:#2b303b;color:#65737e;"># next create the notification event in the bucket
# DANGER: this will overwrite any existing event notifications in your bucket
# DO NOT RUN THIS on a bucket that is important to you or work!
</span><span style="background-color:#2b303b;color:#c0c5ce;">aws s3api put-bucket-notification-configuration \
</span><span style="background-color:#2b303b;color:#bf616a;">  --bucket </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_BUCKET </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --notification-configuration</span><span style="background-color:#2b303b;color:#c0c5ce;"> file://notification.json

</span><span style="background-color:#2b303b;color:#65737e;"># test the integration to see if the message formatting is correct. 
# this should look identical to the actual CloudWatch entry.
# n.b. base64 appears to use the same switch to decode for both BSD and GNU 
# variants
</span><span style="background-color:#2b303b;color:#c0c5ce;">aws lambda invoke \
</span><span style="background-color:#2b303b;color:#bf616a;">  --invocation-type</span><span style="background-color:#2b303b;color:#c0c5ce;"> RequestResponse \
</span><span style="background-color:#2b303b;color:#bf616a;">  --function-name </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --log-type</span><span style="background-color:#2b303b;color:#c0c5ce;"> Tail \
</span><span style="background-color:#2b303b;color:#bf616a;">  --payload</span><span style="background-color:#2b303b;color:#c0c5ce;"> file://payload-test.json outputfile.txt \
  | </span><span style="background-color:#2b303b;color:#8fa1b3;">jq</span><span style="background-color:#2b303b;color:#bf616a;"> -r</span><span style="background-color:#2b303b;color:#c0c5ce;"> .LogResult | </span><span style="background-color:#2b303b;color:#8fa1b3;">base64</span><span style="background-color:#2b303b;color:#bf616a;"> --decode


</span><span style="background-color:#2b303b;color:#65737e;"># Finally let&#39;s test it properly
</span><span style="background-color:#2b303b;color:#bf616a;">touch</span><span style="background-color:#2b303b;color:#c0c5ce;"> hello.txt
</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#c0c5ce;"> s3 cp hello.txt s3://$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_BUCKET</span><span style="background-color:#2b303b;color:#c0c5ce;">/

</span><span style="background-color:#2b303b;color:#65737e;"># If you didn&#39;t install awslogs, you can still use AWS Console to view logs in 
# Cloud Watch.
</span><span style="background-color:#2b303b;color:#c0c5ce;">awslogs get /aws/lambda/s3-blab</span><span style="background-color:#2b303b;color:#bf616a;"> --start</span><span style="background-color:#2b303b;color:#c0c5ce;">=&#39;</span><span style="background-color:#2b303b;color:#a3be8c;">5 min</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;

</span><span style="background-color:#2b303b;color:#65737e;"># Teardown

</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#c0c5ce;"> lambda delete-function</span><span style="background-color:#2b303b;color:#bf616a;"> --function-name </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_NAME

</span><span style="background-color:#2b303b;color:#8fa1b3;">aws</span><span style="background-color:#2b303b;color:#c0c5ce;"> s3api put-bucket-notification-configuration \
</span><span style="background-color:#2b303b;color:#bf616a;">  --bucket </span><span style="background-color:#2b303b;color:#c0c5ce;">$</span><span style="background-color:#2b303b;color:#bf616a;">LAMBDA_S3_BUCKET </span><span style="background-color:#2b303b;color:#c0c5ce;">\
</span><span style="background-color:#2b303b;color:#bf616a;">  --notification-configuration </span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;</span><span style="background-color:#2b303b;color:#a3be8c;">LambdaFunctionConfigurations=[]</span><span style="background-color:#2b303b;color:#c0c5ce;">&#39;

</span><span style="background-color:#2b303b;color:#65737e;"># you may wish to clear down the S3 bucket of your test files and the log group 
# that was created in CloudWatch.
</span></pre>
<h2>API and CLI features and verbs</h2>
<p>### Features</p>
<ul>
<li>Alias</li>
<li>Event Source Mapping</li>
<li>Function</li>
</ul>
<p>### Verbs (CRUD)</p>
<ul>
<li>create</li>
<li>get/list</li>
<li>update (function-[code/configuration])</li>
<li>delete</li>
</ul>
<p>### Outliers</p>
<ul>
<li>add-layer-version-permission</li>
<li>add-permission</li>
<li>delete-function-concurrency</li>
<li>delete-layer-version</li>
<li>get-account-settings</li>
<li>get-function-configuration</li>
<li>get-layer-version</li>
<li>get-layer-version-by-arn</li>
<li>get-layer-version-policy</li>
<li>get-policy</li>
<li>invoke</li>
<li>list-layer-versions</li>
<li>list-layers</li>
<li>list-tags</li>
<li>list-versions-by-function</li>
<li>publish-layer-version</li>
<li>publish-version</li>
<li>put-function-concurrency</li>
<li>remove-layer-version-permission</li>
<li>remove-permission</li>
<li>tag-resource</li>
<li>untag-resource</li>
<li>wait</li>
</ul>
<h2>AWS DevOps Pro Certification Blog Post Series</h2>
<ul>
<li><a href="/2019/aws-devops-pro-certification-intro/">Intro</a></li>
<li>Domain 1: <a href="/2019/aws-devops-pro-certification-sdlc-intro/">SDLC automation</a></li>
<li>Domain 2: <a href="/2019/aws-devops-pro-certification-configuration-management-and-infrastructure-as-code-intro/">Configuration Management and Infrastructure as Code</a>
<ul>
<li><a href="/2019/aws-devops-pro-certification-cloudformation">CloudFormation</a></li>
<li><a href="/2019/aws-devops-pro-certification-elastic-beanstalk/">Elastic Beanstalk</a></li>
<li>OpsWorks</li>
<li>AWS Lambda</li>
<li><a href="/2019/aws-devops-pro-certification-ecs/">AWS ECS</a></li>
<li><a href="/2019/aws-devops-pro-certification-config-managed-services/">AWS Config</a></li>
<li><a href="/2019/aws-devops-pro-certification-config-managed-services/">AWS Managed Services</a></li>
</ul>
</li>
<li>Domain 3: <a href="/2019/aws-devops-pro-certification-monitoring-and-logging">Monitoring and Logging</a></li>
<li>Domain 4: <a href="/2019/aws-devops-pro-certification-policy-standards-automation/">Policies and Standards Automation</a></li>
<li>Domain 5: <a href="/2019/aws-devops-pro-certification-incident-and-event-response/">Incident and Event Response</a></li>
<li>Domain 6: <a href="/2019/aws-devops-pro-certification-high-availability-fault-tolerance-disaster-recover/">High Availability, Fault Tolerance, and Disaster Recovery</a></li>
</ul>

    </article>
    <br /><br />
    <a href="https://twitter.com/share" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </main>
  <footer>
  <hr>
  <p>
    <a href="/license/">CC BY-SA 4.0 / MIT</a>
    -
    <a href="https://github.com/cobalt-org/cobalt.rs">Built with Cobalt</a>
  </p>
  <br>
</footer>

</body>
</html>
